<div class="offerte-container">
  <!-- Navbar con toolbar -->
  <nav class="offerte-navbar">
    <div class="navbar-left">
      <img src="mybills.ico" alt="MyBills Logo" class="navbar-logo">
      <span class="navbar-title">MyBills.com - Offerte</span><br>
    </div>
    <span class="header-spacer"></span>
    <span class="username-display">Ciao, {{getUsername()}} !</span>
    <button mat-icon-button color="accent" matTooltip="Logout" (click)="logout()" class="logout-navbar-btn">
      <mat-icon style="font-size: 28px;">logout</mat-icon>
    </button>
  </nav>

<mat-sidenav-container class="sidenav-container">
  <mat-sidenav mode="side" opened class="sidenav">
    <mat-nav-list>
      <a mat-list-item [routerLink]="['/bollette']">
        <mat-icon matListItemIcon>home</mat-icon>
        <span matListItemTitle>Home</span>
      </a>
      <a *ngIf="showHrFlow" mat-list-item [routerLink]="['/salary']">
        <mat-icon matListItemIcon>business</mat-icon>
        <span matListItemTitle>HRFlow</span>
      </a>
      <a mat-list-item [routerLink]="['/statistiche']">
        <mat-icon matListItemIcon>analytics</mat-icon>
        <span matListItemTitle>Statistiche</span>
      </a>
      <a mat-list-item [routerLink]="['/offerte']">
        <mat-icon matListItemIcon>local_offer</mat-icon>
        <span matListItemTitle>Offerte</span>
      </a>
      <a mat-list-item [routerLink]="['/gamification']">
        <mat-icon matListItemIcon>sports_esports</mat-icon>
        <span matListItemTitle>Accedi e Vinci</span>
      </a>
      
    </mat-nav-list>
  </mat-sidenav>
  <div class="dashboard-layout">
    <div class="filters-panel">
      <h2>Confronta Offerte</h2>
      <form (ngSubmit)="filtraOfferte()">
        <div class="filter-group">
          <label>Tipo servizio:</label>
          <div class="radio-group">
            <div class="radio-row">
              <div><label><input type="radio" [(ngModel)]="filtro.tipo" name="tipo" value="gas"> Gas</label></div>
              <div><label><input type="radio" [(ngModel)]="filtro.tipo" name="tipo" value="luce"> Luce</label></div>
              <div><label><input type="radio" [(ngModel)]="filtro.tipo" name="tipo" value="wifi"> Wi-Fi</label></div>
            </div>
            <div class="radio-row">
              <div><label><input type="radio" [(ngModel)]="filtro.tipo" name="tipo" value="acqua"> Acqua</label></div>
              <div><label><input type="radio" [(ngModel)]="filtro.tipo" name="tipo" value="rifiuti"> Rifiuti</label></div>
              <div><label><input type="radio" [(ngModel)]="filtro.tipo" name="tipo" value=""> Tutti</label></div>
            </div>
          </div>
        </div>
        <div class="filter-group">
          <label style="margin-right:10px">Prezzo massimo</label>
          <input type="number" min="0" [(ngModel)]="filtro.prezzoMax" name="prezzoMax" placeholder="Prezzo massimo" />
        </div>
        <div class="filter-group">
          <label style="margin-right:10px">Durata</label>
          <select [(ngModel)]="filtro.durataMese" name="durataMese">
            <option value="">Tutte</option>
            <option value="4">4 mesi</option>
            <option value="6">6 mesi</option>
            <option value="8">8 mesi</option>
            <option value="12">12 mesi</option>
            <option value="24">24 mesi</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Opzioni aggiuntive</label>
          <div class="checkbox-group vertical">
            <label><input type="checkbox" [(ngModel)]="filtro.energiaVerde" name="energiaVerde"> Energia verde</label>
            <label><input type="checkbox" [(ngModel)]="filtro.nessunVincolo" name="nessunVincolo"> Nessun vincolo</label>
            <label><input type="checkbox" [(ngModel)]="filtro.pagamentoRate" name="pagamentoRate"> Pagamento rateizzato</label>
            <label><input type="checkbox" [(ngModel)]="filtro.modemGratuito" name="modemGratuito"> Modem gratuito</label>
          </div>
        </div>
        <button type="submit" class="btn-filtra">Applica filtri</button>
      </form>
    </div>

    <div class="main-panel">
      <div class="offers-table-panel">
        <h2>Offerte a confronto</h2>
        <table class="offerte-table">
          <thead>
            <tr>
              <th>Fornitore</th>
              <th>Tipo</th>
              <th>Durata</th>
              <th>Prezzo</th>
              <th>Descrizione</th>
              <th>Valida fino al</th>
              <th>Data Attivazione</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let offerta of offerte">
              <td>{{ offerta.fornitore?.nome }}</td>
              <td>{{ offerta.tipo }}</td>
              <td>{{ offerta.durataMese }} mesi</td>
              <td>{{ offerta.importo }} €</td>
              <td>{{ offerta.descrizione }}</td>
              <td style="white-space: nowrap;">{{ offerta.dataFine }}</td>
              <td>
                <ng-container *ngIf="getAttivazionePerOfferta(offerta)">
                  {{ getAttivazionePerOfferta(offerta)?.dataAttivazione }}
                </ng-container>
                <ng-template #vuoto></ng-template>
              </td>
              <td>
                <button class="btn-attiva"
                        (click)="onButtonClick(offerta)"
                        (mouseenter)="onButtonHover(offerta.idOfferta)"
                        (mouseleave)="onButtonLeave()"
                        [ngClass]="{'btn-attivata': getAttivazionePerOfferta(offerta), 'btn-hover-disattiva': getAttivazionePerOfferta(offerta) && hoveredOffertaId === offerta.idOfferta}">
                  {{ getButtonText(offerta) }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="suggestion-panel" *ngIf="offertaSuggerita">
        <h3>Suggerimento</h3>
        <div class="suggestion-card">
          <p>ti consigliamo l'offerta &rarr;</p>
          <h4>{{ offertaSuggerita?.fornitore?.nome }}</h4>
          <div class="suggestion-offerta">{{ offertaSuggerita?.tipo }} {{ offertaSuggerita?.importo }} €</div>
        </div>
      </div>
    </div>
  </div>
</mat-sidenav-container>
</div>
