<div class="statistiche-container">
  <!-- Navbar con toolbar -->
  <nav class="statistiche-navbar">
    <div class="navbar-left">
      <img src="mybills.ico" alt="MyBills Logo" class="navbar-logo">
      <span class="navbar-title">MyBills.com - Statistiche</span><br>
    </div>
    <span class="header-spacer"></span>
    <span class="username-display">Ciao, {{getUsername()}} !</span>
    <button mat-icon-button color="accent" matTooltip="Logout" (click)="logout()" class="logout-navbar-btn">
      <mat-icon style="font-size: 28px;">logout</mat-icon>
    </button>
  </nav>
  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav mode="side" opened class="sidenav">
      <mat-nav-list>
        <a mat-list-item [routerLink]="['/bollette']">
          <mat-icon matListItemIcon>home</mat-icon>
          <span matListItemTitle>Home</span>
        </a>
        <a *ngIf="showHrFlow" mat-list-item [routerLink]="['/salary']">
          <mat-icon matListItemIcon>business</mat-icon>
          <span matListItemTitle>HRFlow</span>
        </a>
        <a mat-list-item [routerLink]="['/statistiche']">
          <mat-icon matListItemIcon>analytics</mat-icon>
          <span matListItemTitle>Statistiche</span>
        </a>
        <a mat-list-item [routerLink]="['/offerte']">
          <mat-icon matListItemIcon>local_offer</mat-icon>
          <span matListItemTitle>Offerte</span>
        </a>
        <a mat-list-item [routerLink]="['/gamification']">
          <mat-icon matListItemIcon>sports_esports</mat-icon>
          <span matListItemTitle>Accedi e Vinci</span>
        </a>
      </mat-nav-list>
    </mat-sidenav>
    <div class="main-content">
      <div class="row filters-media-row g-3 align-items-end">
        <div class="col-12 col-md-8 filters-row">
          <mat-form-field appearance="fill">
            <mat-label>Periodo</mat-label>
            <mat-select [(ngModel)]="periodoSelezionato" (selectionChange)="onPeriodoChange()">
              <mat-option value="3">Ultimi 3 mesi</mat-option>
              <mat-option value="6">Ultimi 6 mesi</mat-option>
              <mat-option value="12">Ultimi 12 mesi</mat-option>
              <mat-option value="60">Ultimi 5 anni</mat-option>
              <mat-option value="max">Tutto</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Data Inizio</mat-label>
            <input matInput [matDatepicker]="pickerInizio" [(ngModel)]="dataInizio" (dateChange)="onFiltroChange()">
            <mat-datepicker-toggle matSuffix [for]="pickerInizio"></mat-datepicker-toggle>
            <mat-datepicker #pickerInizio></mat-datepicker>
          </mat-form-field>
          <mat-form-field appearance="fill">
            <mat-label>Data Fine</mat-label>
            <input matInput [matDatepicker]="pickerFine" [(ngModel)]="dataFine" (dateChange)="onFiltroChange()">
            <mat-datepicker-toggle matSuffix [for]="pickerFine"></mat-datepicker-toggle>
            <mat-datepicker #pickerFine></mat-datepicker>
          </mat-form-field>
        </div>
  <div class="col-12 col-md-4 media-spesa-card">
          <mat-card>
            <div class="media-spesa-title">Spesa media nel periodo selezionato</div>
            <div class="media-spesa-value">{{ spesaMedia | currency:'EUR' }}</div>
            <div class="media-spesa-tipologie">
              <div class="media-spesa-tipologia" *ngFor="let tipo of tipologie">
                <span class="media-spesa-label">{{ tipo }}:</span>
                <span class="media-spesa-value">{{ getSpesaMediaTipologia(tipo) | currency:'EUR' }}</span>
              </div>
            </div>
          </mat-card>
        </div>
      </div>
      <div class="row chart-row g-3">
        <div class="col-12 col-lg-6 chart-container mb-3 mb-lg-0">
          <!-- Pie chart CSS come bollette-dashboard -->
          <div class="pie-chart"></div>
          <div class="chart-legend">
            <div class="chart-item">
              <span class="chart-color gas-color"></span>Gas
              <span class="chart-percent">{{ getPercent('Gas') }}%</span>
            </div>
            <div class="chart-item">
              <span class="chart-color luce-color"></span>Luce
              <span class="chart-percent">{{ getPercent('Luce') }}%</span>
            </div>
            <div class="chart-item">
              <span class="chart-color wifi-color"></span>WiFi
              <span class="chart-percent">{{ getPercent('WiFi') }}%</span>
            </div>
            <div class="chart-item">
              <span class="chart-color acqua-color"></span>Acqua
              <span class="chart-percent">{{ getPercent('Acqua') }}%</span>
            </div>
            <div class="chart-item">
              <span class="chart-color rifiuti-color"></span>Rifiuti
              <span class="chart-percent">{{ getPercent('Rifiuti') }}%</span>
            </div>
          </div>
        </div>
      <div class="col-12 col-lg-6 line-chart-container">
          <div id="googleLineChart" style="width:100%;height:340px;"></div>
        </div>
      </div>
  <div class="table-responsive table-card mt-4">
        <table class="bollette-table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Tipologia</th>
              <th>Importo</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let b of bollettePagate">
              <td>{{b.dataPagamento | date}}</td>
              <td>{{b.tipologia}}</td>
              <td>{{b.importo | currency:'EUR'}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </mat-sidenav-container>
</div>
