<div class="auth-container">
  <!-- Navbar elegante -->
  <nav class="auth-navbar">
    <div class="navbar-left">
      <img src="mybills.ico" alt="MyBills Logo" class="navbar-logo">
      <span class="navbar-title">MyBills</span>
    </div>
    <span class="navbar-slogan">Accedi al tuo spazio bollette</span>
  </nav>

  <!-- Main content -->
  <div class="auth-content">
    <mat-card class="auth-card">
      <mat-card-content>
        <h3 class="form-main-title">{{ isLoginMode ? 'Accedi a MyBills' : 'Registrati in MyBills' }}</h3>
        <form (ngSubmit)="onSubmit()" #authForm="ngForm" novalidate class="modern-form">
          
          <!-- Campi per la registrazione (nome e cognome) -->
          <div *ngIf="!isLoginMode" class="registration-fields" [@slideInOut]>
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nome</mat-label>
              <input 
                matInput 
                [(ngModel)]="nome" 
                name="nome"
                #nomeField="ngModel"
                required
                autocomplete="given-name">
              <mat-icon matPrefix>person</mat-icon>
              <mat-error *ngIf="cfField.invalid && (cfField.dirty || cfField.touched)">
                <ng-container *ngIf="cfField.errors?.['pattern']">Codice fiscale non valido. Inserisci 16 caratteri nel formato corretto.</ng-container>
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Cognome</mat-label>
              <input 
                matInput 
                [(ngModel)]="cognome" 
                name="cognome"
                #cognomeField="ngModel"
                required
                autocomplete="family-name">
              <mat-icon matPrefix>person</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Codice Fiscale</mat-label>
              <input 
                matInput 
                [(ngModel)]="cf" 
                name="cf"
                #cfField="ngModel"
                required
                maxlength="16"
                pattern="^[a-zA-Z]{6}[0-9]{2}[a-zA-Z][0-9]{2}[a-zA-Z][0-9]{3}[a-zA-Z]$" required="required"
                style="text-transform: uppercase;"
                class="cf-input-placeholder"
                placeholder="Es. RSSMRA80A01H501Z">
              <mat-icon matPrefix>badge</mat-icon>
            </mat-form-field>
          </div>

          <!-- Email field (sempre presente) -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{isLoginMode ? 'Email' : 'Email'}}</mat-label>
            <input 
              matInput 
              type="email"
              [(ngModel)]="email" 
              name="email"
              #emailField="ngModel"
              required
              pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
              autocomplete="email"
              [matTooltip]="'Formato richiesto: nomecognome@dominio.com/it'"
              matTooltipPosition="above"
              matTooltipShowDelay="300">
            <mat-icon matPrefix>email</mat-icon>
            
            <!-- Messaggi di errore -->
            <mat-error *ngIf="emailField.invalid && (emailField.dirty || emailField.touched)">
              <span *ngIf="emailField.errors?.['required']">*Questo Ã¨ un campo obbligatorio</span>
              <span *ngIf="emailField.errors?.['pattern']">Inserisci un'email valida (es. nome&#64;dominio.com/it)</span>
            </mat-error>
          </mat-form-field>

          <!-- Password field -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{isLoginMode ? 'Password' : 'Password'}}</mat-label>
            <input 
              matInput 
              type="password"
              [(ngModel)]="password" 
              name="password"
              #passwordField="ngModel"
              required
              autocomplete="current-password">
            <mat-icon matPrefix>lock</mat-icon>
          </mat-form-field>

          <!-- Messaggio di errore -->
          <div *ngIf="errorMessage" class="error-message">
            <mat-icon>error</mat-icon>
            <span>{{ errorMessage }}</span>
          </div>

          <!-- Buttons -->
          <div class="auth-buttons">
            <button 
              mat-raised-button 
              color="primary" 
              type="submit"
              [disabled]="isLoading || !authForm.form.valid"
              class="auth-button">
              <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
              <span *ngIf="!isLoading">{{isLoginMode ? 'Log in' : 'Registrati'}}</span>
              <span *ngIf="isLoading">{{isLoginMode ? 'Accesso in corso...' : 'Registrazione in corso...'}}</span>
            </button>

            <button 
              mat-raised-button  
              type="button"
              [disabled]="isLoading"
              (click)="toggleMode()"
              class="auth-button">
              {{isLoginMode ? 'Registrati' : 'Torna al Login'}}
            </button>
          </div>

        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
